<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>100 Day Task Log</title>
  <style>
    /* Base tokens */
    :root {
      color-scheme: light dark;
    }
    :root[data-theme="light"] {
      --bg: #f7f7fb;
      --panel: #ffffff;
      --card: #ffffff;
      --text: #0b1020;
      --muted: #556275;
      --border: #e6e8ef;
      --accent: #4f7cff; /* soft blue */
      --accent-2: #42c47a; /* mint */
      --danger: #e5484d;
      --focus: #7aa2ff;
      --gradient-a: #f7f9ff;
      --gradient-b: #f2f4fb;
    }
    :root[data-theme="dark"] {
      --bg: #0f172a;
      --panel: #111827;
      --card: #0b1220;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --border: #1f2937;
      --accent: #7aa2ff; /* airy blue */
      --accent-2: #62d292; /* mint */
      --danger: #ef4444;
      --focus: #9bb7ff;
      --gradient-a: #0b1020;
      --gradient-b: #0b0f1a;
    }

    html, body { height: 100%; }
    body {
      margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
      Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: linear-gradient(180deg, var(--gradient-a), var(--gradient-b));
      color: var(--text);
    }
    .container { max-width: 1100px; margin: 0 auto; padding: 20px; }
    header { position: sticky; top: 0; backdrop-filter: blur(8px); background: color-mix(in oklab, var(--gradient-a) 75%, transparent);
      z-index: 10; border-bottom: 1px solid var(--border); }
    header .bar { display: flex; gap: 12px; align-items: center; padding: 12px 20px; flex-wrap: wrap; }
    h1 { font-size: 20px; margin: 0 6px 0 0; letter-spacing: .2px; }
    button, .btn, select, input[type="text"], input[type="time"], input[type="number"] {
      background: var(--card); color: var(--text); border: 1px solid var(--border);
      padding: 8px 10px; border-radius: 10px; font-size: 14px;
    }
    button { cursor: pointer; transition: 120ms ease; display: inline-flex; align-items: center; gap: 8px; }
    button:hover, select:hover { border-color: var(--accent); }
    button.accent { background: color-mix(in oklab, var(--accent) 15%, var(--card)); border-color: var(--accent); }
    button.danger { background: color-mix(in oklab, var(--danger) 15%, var(--card)); border-color: var(--danger); }
    input[type="text"], input[type="time"], input[type="number"], select { outline: none; }
    input[type="text"]:focus, input[type="time"]:focus, input[type="number"]:focus, select:focus {
      border-color: var(--focus); box-shadow: 0 0 0 3px color-mix(in oklab, var(--focus) 30%, transparent);
    }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 14px; }
    .card { background: radial-gradient(1200px 600px at -20% -20%, color-mix(in oklab, var(--accent) 8%, var(--card)) 0%, var(--card) 40%, var(--card) 100%);
      border: 1px solid var(--border); border-radius: 14px; padding: 12px; display: flex; flex-direction: column; }
    .date-row { display: flex; justify-content: space-between; align-items: center; gap: 10px; }
    .date { font-weight: 700; font-size: 14px; }
    .muted { color: var(--muted); font-size: 12px; }
    .tasks { margin-top: 10px; display: flex; flex-direction: column; gap: 8px; }
    .task { display: grid; grid-template-columns: 1fr 100px 30px; gap: 8px; align-items: center; }
    .task input[type="text"] { width: 100%; }
    .task input[type="time"] { width: 100%; }
    .task button.small { padding: 6px; border-radius: 8px; }
    .row-actions { display: flex; gap: 8px; margin-top: 8px; }
    .total { font-weight: 600; font-variant-numeric: tabular-nums; }
    .footer { margin-top: 14px; display: flex; justify-content: space-between; align-items: center; }
    .pill { border: 1px solid var(--border); padding: 2px 8px; border-radius: 999px; font-size: 12px; color: var(--muted); }
    .search-wrap { margin-left: auto; display: flex; align-items: center; gap: 6px; }
    #search { width: 220px; }
    .tip { font-size: 12px; color: var(--muted); margin-left: 8px; }
    .spacer { flex: 1; }
    .status { font-size: 12px; color: var(--muted); }
    @media (max-width: 640px) { #search { width: 140px; } }
  </style>
</head>
<body>
  <header>
    <div class="bar container">
      <h1>100 Day Task Log</h1>
      <select id="dayPicker" title="Go to day"></select>
      <button id="themeToggle" class="btn" title="Toggle light/dark">Theme</button>
      <button id="exportJson" class="btn">Export JSON</button>
      <button id="exportCsv" class="btn">Export CSV</button>
      <input id="importFile" type="file" accept=".json" style="display:none" />
      <button id="importBtn" class="btn">Import JSON</button>
      <button id="clearAll" class="btn danger">Clear All</button>
      <div class="search-wrap">
        <input id="search" type="text" placeholder="Search tasks or dates" />
        <span class="tip">Autosaves as you type</span>
      </div>
      <span class="spacer"></span>
      <div class="legend">
        <span class="status" id="saveStatus">Saved</span>
      </div>
    </div>
  </header>

  <main class="container" style="padding-top: 14px;">
    <div id="grid" class="grid"></div>
  </main>

  <template id="cardTemplate">
    <div class="card" data-date="">
      <div class="date-row">
        <div>
          <div class="date"></div>
          <div class="muted dow"></div>
        </div>
        <div class="pill total">0h 00m</div>
      </div>
      <div class="tasks"></div>
      <div class="row-actions">
        <button class="addTask accent">Add Task</button>
        <button class="clearDay danger" title="Remove all tasks for this day">Clear Day</button>
      </div>
      <div class="footer">
        <span class="muted">Tip: use HH:MM format</span>
        <span class="muted">Everything autosaves</span>
      </div>
    </div>
  </template>

  <template id="taskTemplate">
    <div class="task">
      <input type="text" class="t-name" placeholder="Task description" />
      <input type="time" class="t-time" step="60" />
      <button class="small danger remove" title="Remove task">×</button>
    </div>
  </template>

  <script>
    // Date helpers
    function fmtDate(d) { const y=d.getFullYear(); const m=String(d.getMonth()+1).padStart(2,'0'); const day=String(d.getDate()).padStart(2,'0'); return `${y}-${m}-${day}`; }
    function humanDate(d) { return d.toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric' }); }
    function dayName(d) { return d.toLocaleDateString(undefined, { weekday: 'long' }); }

    // Storage
    const KEY = 'tasklog.v1';
    const THEME_KEY = 'tasklog.theme';
    let store = load();
    function load() { try { return JSON.parse(localStorage.getItem(KEY)) || {}; } catch { return {}; } }
    function saveSoon() {
      setStatus('Saving…');
      if (saveSoon._t) cancelAnimationFrame(saveSoon._t);
      saveSoon._t = requestAnimationFrame(() => { localStorage.setItem(KEY, JSON.stringify(store)); setStatus('Saved'); });
    }
    function setStatus(text) { document.getElementById('saveStatus').textContent = text; }

    // Theme
    const root = document.documentElement;
    function applyTheme(t){ root.setAttribute('data-theme', t); }
    function getPreferredTheme(){ const s=localStorage.getItem(THEME_KEY); if (s) return s; return window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark'; }
    let theme = getPreferredTheme();
    applyTheme(theme);
    document.getElementById('themeToggle').addEventListener('click', ()=>{ theme = theme==='light' ? 'dark' : 'light'; localStorage.setItem(THEME_KEY, theme); applyTheme(theme); });

    // Build next 100 days
    const grid = document.getElementById('grid');
    const cardTpl = document.getElementById('cardTemplate');
    const taskTpl = document.getElementById('taskTemplate');

    const start = new Date(); start.setHours(0,0,0,0);
    const dates = Array.from({ length: 100 }, (_, i) => { const d = new Date(start); d.setDate(d.getDate() + i); return d; });
    const elsByDate = {};

    for (const d of dates) {
      const ds = fmtDate(d);
      const card = cardTpl.content.firstElementChild.cloneNode(true);
      card.dataset.date = ds;
      card.querySelector('.date').textContent = humanDate(d);
      card.querySelector('.dow').textContent = dayName(d);

      const tasksWrap = card.querySelector('.tasks');
      const tasks = (store[ds] && store[ds].tasks) || [];
      if (tasks.length === 0) addTaskRow(tasksWrap); else { for (const t of tasks) addTaskRow(tasksWrap, t.name, t.time); }

      updateTotal(card);

      card.querySelector('.addTask').addEventListener('click', () => {
        const row = addTaskRow(tasksWrap); row.querySelector('.t-name').focus(); persistCard(card);
      });
      card.querySelector('.clearDay').addEventListener('click', () => {
        if (!confirm('Clear all tasks for this day')) return;
        tasksWrap.innerHTML = ''; addTaskRow(tasksWrap); persistCard(card); updateTotal(card);
      });

      grid.appendChild(card);
      elsByDate[ds] = card;
    }

    // Task rows and totals
    function addTaskRow(wrapper, name = '', time = '') {
      const row = taskTpl.content.firstElementChild.cloneNode(true);
      const nameEl = row.querySelector('.t-name');
      const timeEl = row.querySelector('.t-time');
      nameEl.value = name; timeEl.value = time;
      nameEl.addEventListener('keydown', e => { if (e.key === 'Enter') { e.preventDefault(); timeEl.focus(); } });
      nameEl.addEventListener('input', onAnyChange); timeEl.addEventListener('input', onAnyChange);
      row.querySelector('.remove').addEventListener('click', () => { row.remove(); const card = wrapper.closest('.card'); persistCard(card); updateTotal(card); });
      wrapper.appendChild(row); return row;
    }
    function onAnyChange(e){ const card = e.target.closest('.card'); persistCard(card); updateTotal(card); }
    function getCardData(card){ const ds = card.dataset.date; const rows = Array.from(card.querySelectorAll('.task')); const tasks = rows.map(r => ({ name: r.querySelector('.t-name').value.trim(), time: r.querySelector('.t-time').value })).filter(t => t.name || t.time); return { date: ds, tasks }; }
    function persistCard(card){ const data = getCardData(card); store[data.date] = { tasks: data.tasks }; saveSoon(); }
    function parseTimeToMinutes(str){ if (!str) return 0; const [h,m] = str.split(':').map(Number); if (Number.isFinite(h)&&Number.isFinite(m)) return h*60+m; return 0; }
    function minutesToHm(mins){ const h=Math.floor(mins/60); const m=mins%60; return `${h}h ${String(m).padStart(2,'0')}m`; }
    function updateTotal(card){ const rows = card.querySelectorAll('.t-time'); let total = 0; rows.forEach(t => total += parseTimeToMinutes(t.value)); card.querySelector('.total').textContent = minutesToHm(total); }

    // Day picker: jump to a day and start adding
    const dayPicker = document.getElementById('dayPicker');
    for (const d of dates) { const opt = document.createElement('option'); const ds = fmtDate(d); opt.value = ds; opt.textContent = `${dayName(d)}, ${humanDate(d)}`; dayPicker.appendChild(opt); }
    function jumpToDay(ds){ const card = elsByDate[ds]; if (!card) return; card.scrollIntoView({ behavior: 'smooth', block: 'start' }); const tasksWrap = card.querySelector('.tasks'); if (tasksWrap.children.length === 0) addTaskRow(tasksWrap); const firstName = card.querySelector('.t-name'); if (firstName) firstName.focus(); }
    dayPicker.addEventListener('change', () => jumpToDay(dayPicker.value));

    const todayStr = fmtDate(new Date(start)); dayPicker.value = todayStr; jumpToDay(todayStr);

    // Export JSON
    document.getElementById('exportJson').addEventListener('click', () => {
      const payload = { meta: { generated: new Date().toISOString() }, days: store };
      const blob = new Blob([JSON.stringify(payload, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob); download(url, 'task-log.json');
    });

    // Export CSV
    document.getElementById('exportCsv').addEventListener('click', () => {
      const rows = [ ['Date','Task','Time'] ];
      const datesSorted = Object.keys(store).sort();
      for (const d of datesSorted) {
        const tasks = (store[d] && store[d].tasks) || [];
        if (tasks.length === 0) rows.push([d,'','']);
        for (const t of tasks) rows.push([d, t.name || '', t.time || '']);
      }
      const csv = rows.map(r => r.map(s => '"' + String(s).replace(/"/g,'""') + '"').join(',')).join('\n');
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob); download(url, 'task-log.csv');
    });

    function download(url, filename){ const a = document.createElement('a'); a.href = url; a.download = filename; a.style.display = 'none'; document.body.appendChild(a); a.click(); setTimeout(() => { URL.revokeObjectURL(url); a.remove(); }, 0); }

    // Import JSON
    const importInput = document.getElementById('importFile');
    document.getElementById('importBtn').addEventListener('click', () => importInput.click());
    importInput.addEventListener('change', () => {
      const file = importInput.files[0]; if (!file) return; const reader = new FileReader();
      reader.onload = () => {
        try {
          const data = JSON.parse(reader.result);
          if (!data.days || typeof data.days !== 'object') throw new Error('Invalid file');
          store = data.days;
          for (const d of dates) {
            const ds = fmtDate(d); const card = elsByDate[ds]; const tasksWrap = card.querySelector('.tasks');
            tasksWrap.innerHTML = '';
            const tasks = (store[ds] && store[ds].tasks) || [];
            if (tasks.length === 0) addTaskRow(tasksWrap);
            for (const t of tasks) addTaskRow(tasksWrap, t.name, t.time);
            updateTotal(card);
          }
          saveSoon(); alert('Import complete');
        } catch (e) { alert('Could not import this file'); }
        importInput.value = '';
      };
      reader.readAsText(file);
    });

    // Search filter
    document.getElementById('search').addEventListener('input', e => {
      const q = e.target.value.toLowerCase();
      for (const d of dates) {
        const ds = fmtDate(d);
        const card = elsByDate[ds];
        const text = [ds, card.querySelector('.date').textContent, ...Array.from(card.querySelectorAll('.t-name')).map(n => n.value)]
          .join(' ').toLowerCase();
        card.style.display = text.includes(q) ? '' : 'none';
      }
    });

    // Clear all
    document.getElementById('clearAll').addEventListener('click', () => {
      if (!confirm('Delete everything')) return;
      localStorage.removeItem(KEY); store = {};
      for (const d of dates) { const ds = fmtDate(d); const card = elsByDate[ds]; const tasksWrap = card.querySelector('.tasks'); tasksWrap.innerHTML = ''; addTaskRow(tasksWrap); updateTotal(card); }
      setStatus('Cleared');
    });
  </script>
</body>
</html>
